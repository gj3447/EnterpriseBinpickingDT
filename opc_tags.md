# OPC UA 태그 사용 가이드

`GatewayServerV2`가 제공하는 OPC UA 서버 구조, NodeId, 사용 절차를 한눈에 정리했습니다. 이 문서를 그대로 참고하면 RobotSettingsPanel, UaExpert, 커스텀 클라이언트 어디서든 바로 연결해 쓸 수 있습니다.

## 빠른 연결 절차

- **서버 실행**: `python main.py`
- **엔드포인트**: `opc.tcp://<서버IP>:4840/doosan/server/` (예: `opc.tcp://192.168.0.196:4840/doosan/server/`)
- **네임스페이스 URI**: `http://dooly.net/DoosanRobot`
- **접속 정책**: Security None, 인증 Anonymous (기본 설정 그대로)
- **방화벽**: TCP 4840 포트를 허용해야 원격에서 접속 가능
- **로그 위치**: `gateway.log` (주의·오류 상황 확인)

## NodeId 사용 시 주의사항

- 모든 노드는 **Numeric NodeId(ns=2;i=...)**를 사용합니다. 문자열 NodeId(ns=2;s=...)는 존재하지 않으니 `BadNodeIdUnknown`이 나오면 numeric으로 교체하세요.
- NodeId는 서버가 초기화될 때 고정 순서로 생성됩니다. 새 변수를 추가하면 이후 번호가 달라질 수 있으니, 변경 후에는 프런트엔드 상수(`OPC_NODE_IDS`)를 다시 확인해야 합니다.
- UaExpert에서 노드를 선택한 뒤 `Attributes → NodeId` 값을 복사하거나, 아래 파이썬 예제로 전체 NodeId를 덤프할 수 있습니다.

```python
import asyncio
from asyncua import Client

async def dump_all():
    url = "opc.tcp://192.168.0.196:4840/doosan/server/"  # 서버 IP로 수정
    async with Client(url=url) as client:
        myrobot = await client.nodes.objects.get_child(["2:MyRobot"])
        for child in await myrobot.get_children():
            print(child.nodeid.to_string(), (await child.read_browse_name()).Name)

asyncio.run(dump_all())
```

## 전체 트리 구조

```text
Objects (i=85)
└─ MyRobot (ns=2;i=1)
   ├─ Status (ns=2;i=2)
   │  ├─ Custom (ns=2;i=8)
   │  │  ├─ CurrentJoint0 (ns=2;i=20)
   │  │  ├─ ...
   │  │  └─ CurrentToolForce5 (ns=2;i=43)
   │  ├─ CurrentJoints (ns=2;i=10)
   │  ├─ CurrentTCP (ns=2;i=11)
   │  ├─ JointTorques (ns=2;i=12)
   │  ├─ ToolForces (ns=2;i=13)
   │  ├─ MotionState (ns=2;i=14)
   │  ├─ CommandStatus (ns=2;i=15)
   │  └─ ErrorCode (ns=2;i=16)
   ├─ Commands (ns=2;i=3)
   │  ├─ Custom (ns=2;i=9)
   │  ├─ TargetJoints (ns=2;i=50)
   │  ├─ TargetTCP (ns=2;i=51)
   │  ├─ Mode (ns=2;i=52)
   │  ├─ JVel (ns=2;i=53)
   │  ├─ JAcc (ns=2;i=54)
   │  ├─ LVel (ns=2;i=55)
   │  ├─ LAcc (ns=2;i=56)
   │  └─ Trigger (ns=2;i=57)
   ├─ Gripper (ns=2;i=4)
   │  ├─ Status (ns=2;i=5)
   │  │  ├─ In1 (ns=2;i=17)
   │  │  ├─ In2 (ns=2;i=18)
   │  │  └─ In3 (ns=2;i=19)
   │  └─ Commands (ns=2;i=6)
   │     ├─ Open (ns=2;i=58)
   │     └─ Close (ns=2;i=59)
   └─ ModbusConnection (ns=2;i=7)
      ├─ Connected (ns=2;i=44)
      ├─ LastDisconnectTime (ns=2;i=45)
      ├─ LastReconnectTime (ns=2;i=46)
      ├─ ReconnectElapsed (ns=2;i=47)
      ├─ ReconnectAttempts (ns=2;i=48)
      └─ TotalDisconnected (ns=2;i=49)
```

### 전체 브라우즈 덤프 (표준 노드 포함)

표준 OPC UA 서버 노드까지 모두 포함한 실제 브라우즈 결과입니다. MyRobot 외의 대량 노드는 OPC 표준 관리/진단용이므로 필요한 경우에만 사용하세요.

```text
- Objects (i=85)
  - Locations (i=31915)
  - Server (i=2253)
    - ServerArray (i=2254)
    - NamespaceArray (i=2255)
    - UrisVersion (i=15004)
    - ServerStatus (i=2256)
      - StartTime (i=2257)
      - CurrentTime (i=2258)
      - State (i=2259)
      - BuildInfo (i=2260)
        - ProductUri (i=2262)
        - ManufacturerName (i=2263)
        - ProductName (i=2261)
        - SoftwareVersion (i=2264)
        - BuildNumber (i=2265)
        - BuildDate (i=2266)
      - SecondsTillShutdown (i=2992)
      - ShutdownReason (i=2993)
    - ServiceLevel (i=2267)
    - Auditing (i=2994)
    - EstimatedReturnTime (i=12885)
    - LocalTime (i=17634)
    - ServerCapabilities (i=2268)
      - ServerProfileArray (i=2269)
      - LocaleIdArray (i=2271)
      - MinSupportedSampleRate (i=2272)
      - MaxBrowseContinuationPoints (i=2735)
      - MaxQueryContinuationPoints (i=2736)
      - MaxHistoryContinuationPoints (i=2737)
      - SoftwareCertificates (i=3704)
      - MaxArrayLength (i=11702)
      - MaxStringLength (i=11703)
      - MaxByteStringLength (i=12911)
      - OperationLimits (i=11704)
        - MaxNodesPerRead (i=11705)
        - MaxNodesPerHistoryReadData (i=12165)
        - MaxNodesPerHistoryReadEvents (i=12166)
        - MaxNodesPerWrite (i=11707)
        - MaxNodesPerHistoryUpdateData (i=12167)
        - MaxNodesPerHistoryUpdateEvents (i=12168)
        - MaxNodesPerMethodCall (i=11709)
        - MaxNodesPerBrowse (i=11710)
        - MaxNodesPerRegisterNodes (i=11711)
        - MaxNodesPerTranslateBrowsePathsToNodeIds (i=11712)
        - MaxNodesPerNodeManagement (i=11713)
        - MaxMonitoredItemsPerCall (i=11714)
      - ModellingRules (i=2996)
      - AggregateFunctions (i=2997)
      - MaxSessions (i=24095)
      - MaxSubscriptions (i=24096)
      - MaxMonitoredItems (i=24097)
      - MaxSubscriptionsPerSession (i=24098)
      - MaxMonitoredItemsPerSubscription (i=24104)
      - MaxSelectClauseParameters (i=24099)
      - MaxWhereClauseParameters (i=24100)
      - MaxMonitoredItemsQueueSize (i=31916)
      - ConformanceUnits (i=24101)
      - RoleSet (i=15606)
        - AddRole (i=16301)
          - InputArguments (i=16302)
          - OutputArguments (i=16303)
        - RemoveRole (i=16304)
          - InputArguments (i=16305)
        - Anonymous (i=15644)
          - Identities (i=16192)
        - AuthenticatedUser (i=15656)
          - Identities (i=16203)
        - TrustedApplication (i=18625)
          - Identities (i=18626)
        - Observer (i=15668)
          - Identities (i=16214)
          - ApplicationsExclude (i=15416)
          - Applications (i=16215)
          - EndpointsExclude (i=15417)
          - Endpoints (i=16216)
          - CustomConfiguration (i=24142)
          - AddIdentity (i=15672)
            - InputArguments (i=15673)
          - RemoveIdentity (i=15674)
            - InputArguments (i=15675)
          - AddApplication (i=16217)
            - InputArguments (i=16218)
          - RemoveApplication (i=16219)
            - InputArguments (i=16220)
          - AddEndpoint (i=16221)
            - InputArguments (i=16222)
          - RemoveEndpoint (i=16223)
            - InputArguments (i=16224)
        - Operator (i=15680)
          - Identities (i=16225)
          - ApplicationsExclude (i=15418)
          - Applications (i=16226)
          - EndpointsExclude (i=15423)
          - Endpoints (i=16227)
          - CustomConfiguration (i=24143)
          - AddIdentity (i=15684)
            - InputArguments (i=15685)
          - RemoveIdentity (i=15686)
            - InputArguments (i=15687)
          - AddApplication (i=16228)
            - InputArguments (i=16229)
          - RemoveApplication (i=16230)
            - InputArguments (i=16231)
          - AddEndpoint (i=16232)
            - InputArguments (i=16233)
          - RemoveEndpoint (i=16234)
            - InputArguments (i=16235)
        - Engineer (i=16036)
          - Identities (i=16236)
          - ApplicationsExclude (i=15424)
          - Applications (i=16237)
          - EndpointsExclude (i=15425)
          - Endpoints (i=16238)
          - CustomConfiguration (i=24144)
          - AddIdentity (i=16041)
            - InputArguments (i=16042)
          - RemoveIdentity (i=16043)
            - InputArguments (i=16044)
          - AddApplication (i=16239)
            - InputArguments (i=16240)
          - RemoveApplication (i=16241)
            - InputArguments (i=16242)
          - AddEndpoint (i=16243)
            - InputArguments (i=16244)
          - RemoveEndpoint (i=16245)
            - InputArguments (i=16246)
        - Supervisor (i=15692)
          - Identities (i=16247)
          - ApplicationsExclude (i=15426)
          - Applications (i=16248)
          - EndpointsExclude (i=15427)
          - Endpoints (i=16249)
          - CustomConfiguration (i=24145)
          - AddIdentity (i=15696)
            - InputArguments (i=15697)
          - RemoveIdentity (i=15698)
            - InputArguments (i=15699)
          - AddApplication (i=16250)
            - InputArguments (i=16251)
          - RemoveApplication (i=16252)
            - InputArguments (i=16253)
          - AddEndpoint (i=16254)
            - InputArguments (i=16255)
          - RemoveEndpoint (i=16256)
            - InputArguments (i=16257)
        - ConfigureAdmin (i=15716)
          - Identities (i=16269)
          - ApplicationsExclude (i=15428)
          - Applications (i=16270)
          - EndpointsExclude (i=15429)
          - Endpoints (i=16271)
          - CustomConfiguration (i=24146)
          - AddIdentity (i=15720)
            - InputArguments (i=15721)
          - RemoveIdentity (i=15722)
            - InputArguments (i=15723)
          - AddApplication (i=16272)
            - InputArguments (i=16273)
          - RemoveApplication (i=16274)
            - InputArguments (i=16275)
          - AddEndpoint (i=16276)
            - InputArguments (i=16277)
          - RemoveEndpoint (i=16278)
            - InputArguments (i=16279)
        - SecurityAdmin (i=15704)
          - Identities (i=16258)
          - ApplicationsExclude (i=15430)
          - Applications (i=16259)
          - EndpointsExclude (i=15527)
          - Endpoints (i=16260)
          - CustomConfiguration (i=24147)
          - AddIdentity (i=15708)
            - InputArguments (i=15709)
          - RemoveIdentity (i=15710)
            - InputArguments (i=15711)
          - AddApplication (i=16261)
            - InputArguments (i=16262)
          - RemoveApplication (i=16263)
            - InputArguments (i=16264)
          - AddEndpoint (i=16265)
            - InputArguments (i=16266)
          - RemoveEndpoint (i=16267)
            - InputArguments (i=16268)
        - SecurityKeyServerAdmin (i=25565)
          - Identities (i=25566)
          - ApplicationsExclude (i=25567)
          - Applications (i=25568)
          - EndpointsExclude (i=25569)
          - Endpoints (i=25570)
          - CustomConfiguration (i=25571)
          - AddIdentity (i=25572)
            - InputArguments (i=25573)
          - RemoveIdentity (i=25574)
            - InputArguments (i=25575)
          - AddApplication (i=25576)
            - InputArguments (i=25577)
          - RemoveApplication (i=25578)
            - InputArguments (i=25579)
          - AddEndpoint (i=25580)
            - InputArguments (i=25581)
          - RemoveEndpoint (i=25582)
            - InputArguments (i=25583)
        - SecurityKeyServerAccess (i=25603)
          - Identities (i=25604)
          - ApplicationsExclude (i=25605)
          - Applications (i=25606)
          - EndpointsExclude (i=25607)
          - Endpoints (i=25608)
          - CustomConfiguration (i=25609)
          - AddIdentity (i=25610)
            - InputArguments (i=25611)
          - RemoveIdentity (i=25612)
            - InputArguments (i=25613)
          - AddApplication (i=25614)
            - InputArguments (i=25615)
          - RemoveApplication (i=25616)
            - InputArguments (i=25617)
          - AddEndpoint (i=25618)
            - InputArguments (i=25619)
          - RemoveEndpoint (i=25620)
            - InputArguments (i=25621)
        - SecurityKeyServerPush (i=25584)
          - Identities (i=25585)
          - ApplicationsExclude (i=25586)
          - Applications (i=25587)
          - EndpointsExclude (i=25588)
          - Endpoints (i=25589)
          - CustomConfiguration (i=25590)
          - AddIdentity (i=25591)
            - InputArguments (i=25592)
          - RemoveIdentity (i=25593)
            - InputArguments (i=25594)
          - AddApplication (i=25595)
            - InputArguments (i=25596)
          - RemoveApplication (i=25597)
            - InputArguments (i=25598)
          - AddEndpoint (i=25599)
            - InputArguments (i=25600)
          - RemoveEndpoint (i=25601)
            - InputArguments (i=25602)
      - HistoryServerCapabilities (i=11192)
        - AccessHistoryDataCapability (i=11193)
        - AccessHistoryEventsCapability (i=11242)
        - MaxReturnDataValues (i=11273)
        - MaxReturnEventValues (i=11274)
        - InsertDataCapability (i=11196)
        - ReplaceDataCapability (i=11197)
        - UpdateDataCapability (i=11198)
        - DeleteRawCapability (i=11199)
        - DeleteAtTimeCapability (i=11200)
        - InsertEventCapability (i=11281)
        - ReplaceEventCapability (i=11282)
        - UpdateEventCapability (i=11283)
        - DeleteEventCapability (i=11502)
        - InsertAnnotationCapability (i=11275)
        - AggregateFunctions (i=11201)
        - ServerTimestampSupported (i=19091)
    - ServerDiagnostics (i=2274)
      - ServerDiagnosticsSummary (i=2275)
        - ServerViewCount (i=2276)
        - CurrentSessionCount (i=2277)
        - CumulatedSessionCount (i=2278)
        - SecurityRejectedSessionCount (i=2279)
        - RejectedSessionCount (i=3705)
        - SessionTimeoutCount (i=2281)
        - SessionAbortCount (i=2282)
        - PublishingIntervalCount (i=2284)
        - CurrentSubscriptionCount (i=2285)
        - CumulatedSubscriptionCount (i=2286)
        - SecurityRejectedRequestsCount (i=2287)
        - RejectedRequestsCount (i=2288)
      - SamplingIntervalDiagnosticsArray (i=2289)
      - SubscriptionDiagnosticsArray (i=2290)
      - SessionsDiagnosticsSummary (i=3706)
        - SessionDiagnosticsArray (i=3707)
        - SessionSecurityDiagnosticsArray (i=3708)
      - EnabledFlag (i=2294)
    - VendorServerInfo (i=2295)
    - ServerRedundancy (i=2296)
      - RedundancySupport (i=3709)
      - RedundantServerArray (i=11313)
    - Namespaces (i=11715)
      - http://opcfoundation.org/UA/ (i=15957)
        - NamespaceUri (i=15958)
        - NamespaceVersion (i=15959)
        - NamespacePublicationDate (i=15960)
        - IsNamespaceSubset (i=15961)
        - StaticNodeIdTypes (i=15962)
        - StaticNumericNodeIdRange (i=15963)
        - StaticStringNodeIdPattern (i=15964)
        - DefaultRolePermissions (i=16134)
        - DefaultUserRolePermissions (i=16135)
        - DefaultAccessRestrictions (i=16136)
        - ModelVersion (i=32408)
    - GetMonitoredItems (i=11492)
      - InputArguments (i=11493)
      - OutputArguments (i=11494)
    - ResendData (i=12873)
      - InputArguments (i=12874)
    - SetSubscriptionDurable (i=12749)
      - InputArguments (i=12750)
      - OutputArguments (i=12751)
    - RequestServerStateChange (i=12886)
      - InputArguments (i=12887)
    - Dictionaries (i=17594)
    - Quantities (i=32530)
    - DefaultHAConfiguration (i=32637)
      - AggregateFunctions (i=32643)
      - Stepped (i=32644)
      - Definition (i=32645)
      - MaxTimeInterval (i=32646)
      - MinTimeInterval (i=32647)
      - ExceptionDeviation (i=32648)
      - ExceptionDeviationFormat (i=32649)
      - StartOfArchive (i=32650)
      - StartOfOnlineArchive (i=32656)
      - ServerTimestampSupported (i=32682)
      - MaxTimeStoredValues (i=32752)
      - MaxCountStoredValues (i=32753)
      - AggregateConfiguration (i=32638)
        - TreatUncertainAsBad (i=32639)
        - PercentDataBad (i=32640)
        - PercentDataGood (i=32641)
        - UseSlopedExtrapolation (i=32642)
    - DefaultHEConfiguration (i=32754)
      - EventTypes (i=32755)
      - StartOfArchive (i=32756)
      - StartOfOnlineArchive (i=32757)
    - ServerConfiguration (i=12637)
      - CertificateGroups (i=14053)
        - DefaultApplicationGroup (i=14156)
          - TrustList (i=12642)
            - Size (i=12643)
            - Writable (i=14157)
            - UserWritable (i=14158)
            - OpenCount (i=12646)
            - Open (i=12647)
              - InputArguments (i=12648)
              - OutputArguments (i=12649)
            - Close (i=12650)
              - InputArguments (i=12651)
            - Read (i=12652)
              - InputArguments (i=12653)
              - OutputArguments (i=12654)
            - Write (i=12655)
              - InputArguments (i=12656)
            - GetPosition (i=12657)
              - InputArguments (i=12658)
              - OutputArguments (i=12659)
            - SetPosition (i=12660)
              - InputArguments (i=12661)
            - LastUpdateTime (i=12662)
            - OpenWithMasks (i=12663)
              - InputArguments (i=12664)
              - OutputArguments (i=12665)
            - CloseAndUpdate (i=12666)
              - InputArguments (i=14160)
              - OutputArguments (i=12667)
            - AddCertificate (i=12668)
              - InputArguments (i=12669)
            - RemoveCertificate (i=12670)
              - InputArguments (i=12671)
          - CertificateTypes (i=14161)
        - DefaultHttpsGroup (i=14088)
          - TrustList (i=14089)
            - Size (i=14090)
            - Writable (i=14091)
            - UserWritable (i=14092)
            - OpenCount (i=14093)
            - Open (i=14095)
              - InputArguments (i=14096)
              - OutputArguments (i=14097)
            - Close (i=14098)
              - InputArguments (i=14099)
            - Read (i=14100)
              - InputArguments (i=14101)
              - OutputArguments (i=14102)
            - Write (i=14103)
              - InputArguments (i=14104)
            - GetPosition (i=14105)
              - InputArguments (i=14106)
              - OutputArguments (i=14107)
            - SetPosition (i=14108)
              - InputArguments (i=14109)
            - LastUpdateTime (i=14110)
            - OpenWithMasks (i=14111)
              - InputArguments (i=14112)
              - OutputArguments (i=14113)
            - CloseAndUpdate (i=14114)
              - InputArguments (i=14115)
              - OutputArguments (i=14116)
            - AddCertificate (i=14117)
              - InputArguments (i=14118)
            - RemoveCertificate (i=14119)
              - InputArguments (i=14120)
          - CertificateTypes (i=14121)
        - DefaultUserTokenGroup (i=14122)
          - TrustList (i=14123)
            - Size (i=14124)
            - Writable (i=14125)
            - UserWritable (i=14126)
            - OpenCount (i=14127)
            - Open (i=14129)
              - InputArguments (i=14130)
              - OutputArguments (i=14131)
            - Close (i=14132)
              - InputArguments (i=14133)
            - Read (i=14134)
              - InputArguments (i=14135)
              - OutputArguments (i=14136)
            - Write (i=14137)
              - InputArguments (i=14138)
            - GetPosition (i=14139)
              - InputArguments (i=14140)
              - OutputArguments (i=14141)
            - SetPosition (i=14142)
              - InputArguments (i=14143)
            - LastUpdateTime (i=14144)
            - OpenWithMasks (i=14145)
              - InputArguments (i=14146)
              - OutputArguments (i=14147)
            - CloseAndUpdate (i=14148)
              - InputArguments (i=14149)
              - OutputArguments (i=14150)
            - AddCertificate (i=14151)
              - InputArguments (i=14152)
            - RemoveCertificate (i=14153)
              - InputArguments (i=14154)
          - CertificateTypes (i=14155)
      - ApplicationUri (i=25706)
      - ProductUri (i=25725)
      - ApplicationType (i=25707)
      - ServerCapabilities (i=12710)
      - SupportedPrivateKeyFormats (i=12639)
      - MaxTrustListSize (i=12640)
      - MulticastDnsEnabled (i=12641)
      - HasSecureElement (i=23597)
      - UpdateCertificate (i=13737)
        - InputArguments (i=13738)
        - OutputArguments (i=13739)
      - ApplyChanges (i=12740)
      - CancelChanges (i=25708)
      - CreateSigningRequest (i=12737)
        - InputArguments (i=12738)
        - OutputArguments (i=12739)
      - GetRejectedList (i=12777)
        - OutputArguments (i=12778)
      - ResetToServerDefaults (i=25709)
      - TransactionDiagnostics (i=32336)
        - StartTime (i=32337)
        - EndTime (i=32338)
        - Result (i=32339)
        - AffectedTrustLists (i=32340)
        - AffectedCertificateGroups (i=32341)
        - Errors (i=32342)
      - KeyCredentialConfiguration (i=18155)
        - CreateCredential (i=17528)
          - InputArguments (i=17529)
          - OutputArguments (i=17530)
      - AuthorizationServices (i=17732)
      - UserManagement (i=24290)
        - Users (i=24301)
        - PasswordLength (i=24302)
        - PasswordOptions (i=24303)
        - PasswordRestrictions (i=24291)
        - AddUser (i=24304)
          - InputArguments (i=24305)
        - ModifyUser (i=24306)
          - InputArguments (i=24307)
        - RemoveUser (i=24308)
          - InputArguments (i=24309)
        - ChangePassword (i=24310)
          - InputArguments (i=24311)
    - PublishSubscribe (i=14443)
      - GetSecurityKeys (i=15215)
        - InputArguments (i=15216)
        - OutputArguments (i=15217)
      - GetSecurityGroup (i=15440)
        - InputArguments (i=15441)
        - OutputArguments (i=15442)
      - SecurityGroups (i=15443)
        - AddSecurityGroup (i=15444)
          - InputArguments (i=15445)
          - OutputArguments (i=15446)
        - RemoveSecurityGroup (i=15447)
          - InputArguments (i=15448)
      - KeyPushTargets (i=25440)
        - AddPushTarget (i=25441)
          - InputArguments (i=25442)
          - OutputArguments (i=25443)
        - RemovePushTarget (i=25444)
          - InputArguments (i=25445)
      - SetSecurityKeys (i=17364)
        - InputArguments (i=17365)
      - AddConnection (i=17366)
        - InputArguments (i=17367)
        - OutputArguments (i=17368)
      - RemoveConnection (i=17369)
        - InputArguments (i=17370)
      - DataSetClasses (i=23685)
      - SupportedTransportProfiles (i=17481)
      - DefaultDatagramPublisherId (i=25480)
      - ConfigurationVersion (i=25481)
      - DefaultSecurityKeyServices (i=32403)
      - ConfigurationProperties (i=32404)
      - PublishedDataSets (i=17371)
      - SubscribedDataSets (i=23658)
      - PubSubConfiguration (i=25451)
        - Size (i=25452)
        - Writable (i=25453)
        - UserWritable (i=25454)
        - OpenCount (i=25455)
        - Open (i=25459)
          - InputArguments (i=25460)
          - OutputArguments (i=25461)
        - Close (i=25462)
          - InputArguments (i=25463)
        - Read (i=25464)
          - InputArguments (i=25465)
          - OutputArguments (i=25466)
        - Write (i=25467)
          - InputArguments (i=25468)
        - GetPosition (i=25469)
          - InputArguments (i=25470)
          - OutputArguments (i=25471)
        - SetPosition (i=25472)
          - InputArguments (i=25473)
        - ReserveIds (i=25474)
          - InputArguments (i=25475)
          - OutputArguments (i=25476)
        - CloseAndUpdate (i=25477)
          - InputArguments (i=25478)
          - OutputArguments (i=25479)
      - Status (i=17405)
        - State (i=17406)
      - Diagnostics (i=17409)
        - DiagnosticsLevel (i=17410)
        - TotalInformation (i=17411)
          - Active (i=17412)
          - Classification (i=17413)
          - DiagnosticsLevel (i=17414)
        - TotalError (i=17416)
          - Active (i=17417)
          - Classification (i=17418)
          - DiagnosticsLevel (i=17419)
        - Reset (i=17421)
        - SubError (i=17422)
        - Counters (i=17423)
          - StateError (i=17424)
            - Active (i=17425)
            - Classification (i=17426)
            - DiagnosticsLevel (i=17429)
          - StateOperationalByMethod (i=17431)
            - Active (i=17432)
            - Classification (i=17433)
            - DiagnosticsLevel (i=17434)
          - StateOperationalByParent (i=17436)
            - Active (i=17437)
            - Classification (i=17438)
            - DiagnosticsLevel (i=17439)
          - StateOperationalFromError (i=17441)
            - Active (i=17442)
            - Classification (i=17443)
            - DiagnosticsLevel (i=17444)
          - StatePausedByParent (i=17446)
            - Active (i=17447)
            - Classification (i=17448)
            - DiagnosticsLevel (i=17449)
          - StateDisabledByMethod (i=17451)
            - Active (i=17452)
            - Classification (i=17453)
            - DiagnosticsLevel (i=17454)
        - LiveValues (i=17457)
          - ConfiguredDataSetWriters (i=17458)
            - DiagnosticsLevel (i=17459)
          - ConfiguredDataSetReaders (i=17460)
            - DiagnosticsLevel (i=17461)
          - OperationalDataSetWriters (i=17462)
            - DiagnosticsLevel (i=17463)
          - OperationalDataSetReaders (i=17464)
            - DiagnosticsLevel (i=17466)
      - PubSubCapablities (i=23678)
        - MaxPubSubConnections (i=23679)
        - MaxWriterGroups (i=23680)
        - MaxReaderGroups (i=23681)
        - MaxDataSetWriters (i=23682)
        - MaxDataSetReaders (i=23683)
        - MaxFieldsPerDataSet (i=23684)
        - MaxDataSetWritersPerGroup (i=32398)
        - MaxSecurityGroups (i=32839)
        - MaxPushTargets (i=32840)
        - MaxPublishedDataSets (i=32841)
        - MaxStandaloneSubscribedDataSets (i=32842)
        - MaxNetworkMessageSizeDatagram (i=32399)
        - MaxNetworkMessageSizeBroker (i=32400)
        - SupportSecurityKeyPull (i=32401)
        - SupportSecurityKeyPush (i=32402)
        - SupportSecurityKeyServer (i=32843)
    - Resources (i=24226)
      - Communication (i=24227)
        - MappingTables (i=24228)
        - NetworkInterfaces (i=24229)
        - Streams (i=24230)
          - TalkerStreams (i=24231)
          - ListenerStreams (i=24232)
        - LLDP (i=18958)
          - LocalSystemData (i=18965)
            - ChassisIdSubtype (i=18966)
            - ChassisId (i=18967)
            - SystemName (i=18968)
            - SystemDescription (i=18969)
          - Ports (i=18972)
      - ManagedApplications (i=16706)
      - ProvisionableDevice (i=29878)
        - IsSingleton (i=29879)
        - RequestTickets (i=29880)
          - OutputArguments (i=29881)
  - Aliases (i=23470)
    - FindAlias (i=23476)
      - InputArguments (i=23477)
      - OutputArguments (i=23478)
    - LastChange (i=32852)
    - TagVariables (i=23479)
      - FindAlias (i=23485)
        - InputArguments (i=23486)
        - OutputArguments (i=23487)
    - Topics (i=23488)
      - FindAlias (i=23494)
        - InputArguments (i=23495)
        - OutputArguments (i=23496)
  - MyRobot (ns=2;i=1)
    - Status (ns=2;i=2)
      - Custom (ns=2;i=8)
        - CurrentJoint0 (ns=2;i=20)
        - CurrentJoint1 (ns=2;i=21)
        - CurrentJoint2 (ns=2;i=22)
        - CurrentJoint3 (ns=2;i=23)
        - CurrentJoint4 (ns=2;i=24)
        - CurrentJoint5 (ns=2;i=25)
        - CurrentTcp0 (ns=2;i=26)
        - CurrentTcp1 (ns=2;i=27)
        - CurrentTcp2 (ns=2;i=28)
        - CurrentTcp3 (ns=2;i=29)
        - CurrentTcp4 (ns=2;i=30)
        - CurrentTcp5 (ns=2;i=31)
        - CurrentTorque0 (ns=2;i=32)
        - CurrentTorque1 (ns=2;i=33)
        - CurrentTorque2 (ns=2;i=34)
        - CurrentTorque3 (ns=2;i=35)
        - CurrentTorque4 (ns=2;i=36)
        - CurrentTorque5 (ns=2;i=37)
        - CurrentToolForce0 (ns=2;i=38)
        - CurrentToolForce1 (ns=2;i=39)
        - CurrentToolForce2 (ns=2;i=40)
        - CurrentToolForce3 (ns=2;i=41)
        - CurrentToolForce4 (ns=2;i=42)
        - CurrentToolForce5 (ns=2;i=43)
      - CurrentJoints (ns=2;i=10)
      - CurrentTCP (ns=2;i=11)
      - JointTorques (ns=2;i=12)
      - ToolForces (ns=2;i=13)
      - MotionState (ns=2;i=14)
      - CommandStatus (ns=2;i=15)
      - ErrorCode (ns=2;i=16)
    - Commands (ns=2;i=3)
      - Custom (ns=2;i=9)
      - TargetJoints (ns=2;i=50)
      - TargetTCP (ns=2;i=51)
      - Mode (ns=2;i=52)
      - JVel (ns=2;i=53)
      - JAcc (ns=2;i=54)
      - LVel (ns=2;i=55)
      - LAcc (ns=2;i=56)
      - Trigger (ns=2;i=57)
    - Gripper (ns=2;i=4)
      - Status (ns=2;i=5)
        - In1 (ns=2;i=17)
        - In2 (ns=2;i=18)
        - In3 (ns=2;i=19)
      - Commands (ns=2;i=6)
        - Open (ns=2;i=58)
        - Close (ns=2;i=59)
    - ModbusConnection (ns=2;i=7)
      - Connected (ns=2;i=44)
      - LastDisconnectTime (ns=2;i=45)
      - LastReconnectTime (ns=2;i=46)
      - ReconnectElapsed (ns=2;i=47)
      - ReconnectAttempts (ns=2;i=48)
      - TotalDisconnected (ns=2;i=49)
```

## 폴더별 태그 상세

### Status 폴더 (`ns=2;i=2`)

| Browse Name | NodeId | 타입 | 접근 | 설명 |
| --- | --- | --- | --- | --- |
| CurrentJoints | `ns=2;i=10` | Double[6] | R | 현재 조인트 각도(도) |
| CurrentTCP | `ns=2;i=11` | Double[6] | R | TCP 위치/자세 (컨트롤러 포맷) |
| JointTorques | `ns=2;i=12` | Double[6] | R | 조인트 토크 |
| ToolForces | `ns=2;i=13` | Double[6] | R | TCP 힘/모멘트 |
| MotionState | `ns=2;i=14` | Int32 | R | 모션 상태 플래그 |
| CommandStatus | `ns=2;i=15` | Int32 | R | 명령 실행 상태 (`0=완료/1=진행/2=에러`) |
| ErrorCode | `ns=2;i=16` | Int32 | R | 상세 에러 코드 |

#### Status/Custom (`ns=2;i=8`)

| Browse Name | NodeId | 타입 | 설명 |
| --- | --- | --- | --- |
| CurrentJoint0~5 | `ns=2;i=20~25` | Double | 각 조인트 단일 값 |
| CurrentTcp0~5 | `ns=2;i=26~31` | Double | TCP 단일 축 값 |
| CurrentTorque0~5 | `ns=2;i=32~37` | Double | 조인트별 토크 |
| CurrentToolForce0~5 | `ns=2;i=38~43` | Double | TCP 힘/모멘트 |

### Commands 폴더 (`ns=2;i=3`)

| Browse Name | NodeId | 타입 | 접근 | 설명 |
| --- | --- | --- | --- | --- |
| TargetJoints | `ns=2;i=50` | Double[6] | R/W | moveJ 목표 각도 |
| TargetTCP | `ns=2;i=51` | Double[6] | R/W | moveL 목표 TCP |
| Mode | `ns=2;i=52` | Int32 | R/W | `1=moveJ`, `2=moveL` |
| JVel | `ns=2;i=53` | Double | R/W | moveJ 속도 |
| JAcc | `ns=2;i=54` | Double | R/W | moveJ 가속도 |
| LVel | `ns=2;i=55` | Double | R/W | moveL 속도 |
| LAcc | `ns=2;i=56` | Double | R/W | moveL 가속도 |
| Trigger | `ns=2;i=57` | Int32 | R/W | 모션 트리거 (`1` → 실행, 자동 `0`) |

> Commands/Custom(`ns=2;i=9`)은 확장용 폴더로 현재는 비어 있습니다.

### Gripper 폴더 (`ns=2;i=4`)

| Browse Name | NodeId | 타입 | 접근 | 설명 |
| --- | --- | --- | --- | --- |
| Status/In1 | `ns=2;i=17` | Boolean | R | 입력 신호 1 |
| Status/In2 | `ns=2;i=18` | Boolean | R | 입력 신호 2 |
| Status/In3 | `ns=2;i=19` | Boolean | R | 입력 신호 3 |
| Commands/Open | `ns=2;i=58` | Boolean | R/W | 출력 1 (일반적으로 오픈) |
| Commands/Close | `ns=2;i=59` | Boolean | R/W | 출력 2 (일반적으로 클로즈) |

### ModbusConnection 폴더 (`ns=2;i=7`)

| Browse Name | NodeId | 타입 | 설명 |
| --- | --- | --- | --- |
| Connected | `ns=2;i=44` | Boolean | 현재 Modbus 소켓 연결 여부 |
| LastDisconnectTime | `ns=2;i=45` | String | 마지막 끊김 시각 (ISO8601) |
| LastReconnectTime | `ns=2;i=46` | String | 마지막 재연결 시각 |
| ReconnectElapsed | `ns=2;i=47` | Int32 | 재연결 대기 시간(미사용) |
| ReconnectAttempts | `ns=2;i=48` | Int32 | 연속 재연결 실패 횟수 |
| TotalDisconnected | `ns=2;i=49` | Int32 | 누적 끊김 횟수 |

## 모션 및 그리퍼 제어 절차

1. **연결 확인**: `ModbusConnection/Connected`가 `true`인지 먼저 확인합니다.
2. **모션 모드 선택**: `Commands/Mode`에 `1`(moveJ) 또는 `2`(moveL) 기록.
3. **목표값 작성**:
   - moveJ: `TargetJoints`, `JVel`, `JAcc`
   - moveL: `TargetTCP`, `LVel`, `LAcc`
4. **자동 제한**: `robot_config.json`에 정의된 각도·속도 제한을 벗어나면 서버가 즉시 값을 클램핑하고 로그를 남깁니다.
5. **트리거 실행**: `Trigger`에 `1`을 쓰면 서버가 Modbus 명령을 전송하고 곧바로 `0`으로 되돌립니다.
6. **결과 확인**: `Status/CommandStatus`, `Status/ErrorCode`로 실행 결과 모니터링 (`0=완료`).

그리퍼 제어는 `Gripper/Commands/Open` 또는 `Close`에 `true/false`를 쓰면 즉시 Modbus 출력(주소 186/187)으로 전달되며, 입력 상태는 `Gripper/Status/In1~3`에서 확인할 수 있습니다.

## 데이터 스케일과 주기

- Modbus 값은 `SCALE_FACTOR = 100.0`을 적용해 실수로 변환합니다. OPC UA 측에는 **실제 물리 단위(Double)**로 기록됩니다.
- 상태 갱신 주기: 약 100 ms (`_update_opc_nodes_task`).
- 명령 상태/에러 확인 주기: 30~100 ms.

## 문제 해결 체크리스트

- `BadNodeIdUnknown`: 문자열 NodeId 사용 여부 확인 → numeric으로 교체.
- 값이 안 들어오면 `ModbusConnection/Connected` 상태와 `gateway.log`를 먼저 확인.
- 노드를 추가·변경했다면 프런트엔드 상수와 테스트 클라이언트의 NodeId를 함께 업데이트.

## 참고 파일

- `GatewayServerv2.py`: 노드 생성, 명령 처리, Modbus 연동 로직
- `setting.py`: 엔드포인트, 포트, Modbus 주소 정의
- `robot_config.json`: 각도·속도 제한값 및 기타 설정
- `func.py`: Modbus <-> 실수 변환, 로깅 유틸

필요 시 `gatewayserver 개선_포인트.txt`와 `gateway.log`를 기반으로 태그를 확장하거나 튜닝하세요.

